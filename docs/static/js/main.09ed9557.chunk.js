(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{138:function(e,t,a){e.exports=a(301)},143:function(e,t,a){},301:function(e,t,a){"use strict";a.r(t);var n,r=a(1),c=a.n(r),s=a(30),u=a.n(s),l=(a(143),a(145),a(19)),o=a(304),i=a(277),m=a(276),d=a(302),f=a(275),p=a(274),E=a(18),_=a.n(E),S=a(17),b=a.n(S),O=a(28);!function(e){e.URL="taiga_url",e.PID="taiga_pid",e.MID="taiga_mid",e.CUSTOM_EID="taiga_custom_eid",e.CUSTOM_RID="taiga_custom_rid",e.BIZ_DAYS="taiga_biz_days"}(n||(n={}));var T,v=function(e){return"".concat(e.replace(/[\xa5\/]$/,""),"/api/v1")},y=localStorage.getItem(n.URL)||"",g=localStorage.getItem(n.PID)||"",j=localStorage.getItem(n.MID)||"",C=localStorage.getItem(n.CUSTOM_EID)||"",h=localStorage.getItem(n.CUSTOM_RID)||"",k=localStorage.getItem(n.BIZ_DAYS),M={url:y,pid:g,mid:j,custom_eid:C,custom_rid:h,custom_attrs:[],biz_days:_.a.isEmpty(k)?[]:k.split(","),milestones:[],tasks:[],custom_value_map:new WeakMap},I=Object(r.createContext)({state:M,setUrl:function(e){},setPid:function(e){},setMid:function(e){},setMilestones:function(e){},setCustomEid:function(e){},setCustomRid:function(e){},setCustomAttrs:function(e){},setBizDays:function(e){},setTasks:function(e){},setCustomValueMap:function(e){}});!function(e){e.SET_URL="SET_URL",e.SET_PID="SET_PID",e.SET_MID="SET_MID",e.SET_MILESTONES="SET_MILESTONES",e.SET_CUSTOM_EID="SET_CUSTOM_EID",e.SET_CUSTOM_RID="SET_CUSTOM_RID",e.SET_CUSTOM_ATTRS="SET_CUSTOM_ATTRS",e.SET_BIZ_DAYS="SET_BIZ_DAYS",e.SET_TASKS="SET_TASKS",e.SET_CUSTOM_VALUE_MAP="SET_CUSTOM_VALUE_MAP"}(T||(T={}));var D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T.SET_URL:var a=t.payload.url;return Object(O.a)({},e,{url:a});case T.SET_PID:var n=t.payload.pid;return Object(O.a)({},e,{pid:n});case T.SET_MID:var r=t.payload.mid;return Object(O.a)({},e,{mid:r});case T.SET_MILESTONES:var c=t.payload.milestones;return Object(O.a)({},e,{milestones:c});case T.SET_CUSTOM_EID:var s=t.payload.custom_eid;return Object(O.a)({},e,{custom_eid:s});case T.SET_CUSTOM_ATTRS:var u=t.payload.custom_attrs;return Object(O.a)({},e,{custom_attrs:u});case T.SET_CUSTOM_RID:var l=t.payload.custom_rid;return Object(O.a)({},e,{custom_rid:l});case T.SET_BIZ_DAYS:var o=t.payload.biz_days;return Object(O.a)({},e,{biz_days:o});case T.SET_TASKS:var i=t.payload.tasks;return Object(O.a)({},e,{tasks:i});case T.SET_CUSTOM_VALUE_MAP:var m=t.payload.custom_value_map;return Object(O.a)({},e,{custom_value_map:m});default:return e}},U=function(e){var t=e.children,a=Object(r.useReducer)(D,M),s=Object(l.a)(a,2),u=s[0],o=s[1],i={state:u,setUrl:Object(r.useCallback)(function(e){o({type:T.SET_URL,payload:{url:e}}),localStorage.setItem(n.URL,e)},[o]),setPid:Object(r.useCallback)(function(e){o({type:T.SET_PID,payload:{pid:e}}),localStorage.setItem(n.PID,e)},[o]),setMid:Object(r.useCallback)(function(e){o({type:T.SET_MID,payload:{mid:e}}),localStorage.setItem(n.MID,e)},[o]),setMilestones:Object(r.useCallback)(function(e){o({type:T.SET_MILESTONES,payload:{milestones:e}})},[o]),setCustomEid:Object(r.useCallback)(function(e){o({type:T.SET_CUSTOM_EID,payload:{custom_eid:e}}),localStorage.setItem(n.CUSTOM_EID,e)},[o]),setCustomRid:Object(r.useCallback)(function(e){o({type:T.SET_CUSTOM_RID,payload:{custom_rid:e}}),localStorage.setItem(n.CUSTOM_RID,e)},[o]),setCustomAttrs:Object(r.useCallback)(function(e){o({type:T.SET_CUSTOM_ATTRS,payload:{custom_attrs:e}})},[o]),setBizDays:Object(r.useCallback)(function(e){o({type:T.SET_BIZ_DAYS,payload:{biz_days:e}}),localStorage.setItem(n.BIZ_DAYS,e.join(","))},[o]),setTasks:Object(r.useCallback)(function(e){o({type:T.SET_TASKS,payload:{tasks:e}})},[o]),setCustomValueMap:Object(r.useCallback)(function(e){o({type:T.SET_CUSTOM_VALUE_MAP,payload:{custom_value_map:e}})},[o])};return c.a.createElement(I.Provider,{value:i},t)},w=function(e,t,a){return _.a.chain(t).map(function(t){return function(e,t,a){return e.has(t)?Number(_.a.get(e.get(t),"attributes_values.".concat(a),0)):0}(e,t,Number(a))}).sum().value()},A=function(){var e=Object(r.useState)([]),t=Object(l.a)(e,2),a=t[0],n=t[1],s=Object(r.useContext)(I).state,u=s.tasks,E=s.biz_days,_=s.custom_value_map,S=s.custom_eid;return Object(r.useEffect)(function(){var e=E.length;if(e>0&&u.length>0&&S){var t=w(_,function(e,t){return e.filter(function(e){return b()(t).diff(b()(e.created_date))>0})}(u,E[0]),S),a=E.map(function(a,n){var r="day ".concat(n+1),c=t-t*n/(e-1);return b()().diff(b()(a),"days")>=0?{label:r,estimate:c,result:t-w(_,function(e,t){return e.filter(function(e){return!!e.finished_date&&b()(t).diff(b()(e.finished_date))>0})}(u,a),S),add:0===n?0:w(_,function(e,t){return e.filter(function(e){return b()(t).format("YYYY-MM-DD")===b()(e.created_date).format("YYYY-MM-DD")})}(u,a),S)}:{label:r,estimate:c}});n(a)}},[u,E,S,_,n]),c.a.createElement(o.a,{data:a,width:800,height:400},c.a.createElement(i.a,null),c.a.createElement(m.a,{dataKey:"label"}),c.a.createElement(d.a,null),c.a.createElement(f.a,{dataKey:"result",fill:"#8884d8",stackId:"a"}),c.a.createElement(f.a,{dataKey:"add",fill:"#82ca9d",stackId:"a"}),c.a.createElement(p.a,{dataKey:"estimate"}))},x=a(12),R=a(14),Y=a.n(R),N=a(27),P=a(32),L=a.n(P),B=a(44),z=a.n(B),V=function(){var e=Object(r.useContext)(I),t=e.state,a=t.url,n=t.pid,s=e.setPid,u=Object(r.useState)([]),o=Object(l.a)(u,2),i=o[0],m=o[1],d=Object(r.useCallback)(function(e){var t=e.target.value;t&&s(t)},[s]);return Object(r.useEffect)(function(){a&&Object(N.a)(Y.a.mark(function e(){var t,n;return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a.get("".concat(v(a),"/projects"));case 2:t=e.sent,n=t.data,m(n);case 5:case"end":return e.stop()}},e,this)}))()},[a,m]),c.a.createElement(x.d,{className:"col"},c.a.createElement(z.a,{addonType:"prepend"},"Project"),c.a.createElement(x.c,{type:"select",onChange:d},c.a.createElement("option",null," --- "),i.map(function(e){return c.a.createElement("option",{key:e.id,value:e.id,selected:String(e.id)===n},e.name)})))},K=function(){var e=Object(r.useContext)(I),t=e.state,a=t.url,n=t.pid,s=t.mid,u=e.setMid,o=e.setMilestones,i=e.setTasks,m=Object(r.useState)([]),d=Object(l.a)(m,2),f=d[0],p=d[1],E=Object(r.useCallback)(function(e){var t=e.target.value;t&&u(t)},[u,f]);return Object(r.useEffect)(function(){a&&n&&Object(N.a)(Y.a.mark(function e(){var t,r;return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a.get("".concat(v(a),"/milestones"),{params:{project:n}});case 2:t=e.sent,r=t.data,p(r),o(r);case 6:case"end":return e.stop()}},e,this)}))()},[a,n,p,o]),Object(r.useEffect)(function(){a&&s&&Object(N.a)(Y.a.mark(function e(){var t,n;return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a.get("".concat(v(a),"/tasks"),{headers:{"x-disable-pagination":!0},params:{milestone:s}});case 2:t=e.sent,n=t.data,i(n);case 5:case"end":return e.stop()}},e,this)}))()},[a,s,i]),c.a.createElement(x.d,{className:"col"},c.a.createElement(z.a,{addonType:"prepend"},"Sprint"),c.a.createElement(x.c,{type:"select",onChange:E},c.a.createElement("option",null," --- "),f.map(function(e){return c.a.createElement("option",{key:e.id,value:e.id,selected:String(e.id)===s},e.name)})))},Z=function(){var e=Object(r.useContext)(I),t=e.state,a=t.url,n=t.pid,s=t.custom_eid,u=t.custom_rid,o=t.tasks,i=e.setCustomEid,m=e.setCustomRid,d=e.setCustomAttrs,f=e.setCustomValueMap,p=Object(r.useState)([]),E=Object(l.a)(p,2),_=E[0],S=E[1],b=Object(r.useCallback)(function(e){var t=e.target.value;if(t)switch(e.target.name){case"eid":i(t);break;case"rid":m(t)}},[i,m]);return Object(r.useEffect)(function(){a&&n&&Object(N.a)(Y.a.mark(function e(){var t,r;return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a.get("".concat(v(a),"/task-custom-attributes"),{params:{project:n}});case 2:t=e.sent,r=t.data,S(r),d(r);case 6:case"end":return e.stop()}},e,this)}))()},[a,n,S,d]),Object(r.useEffect)(function(){a&&o.length&&s&&u&&Object(N.a)(Y.a.mark(function e(){var t;return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=WeakMap,e.next=3,Promise.all(o.map(function(){var e=Object(N.a)(Y.a.mark(function e(t){var n,r;return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a.get("".concat(v(a),"/tasks/custom-attributes-values/").concat(t.id));case 2:return n=e.sent,r=n.data,e.abrupt("return",[t,r]);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()));case 3:e.t1=e.sent,t=new e.t0(e.t1),f(t);case 6:case"end":return e.stop()}},e,this)}))()},[a,o,s,u,f]),c.a.createElement("div",{className:"row"},c.a.createElement(x.d,{className:"col"},c.a.createElement(z.a,{addonType:"prepend"},"Estimate"),c.a.createElement(x.c,{name:"eid",type:"select",onChange:b},c.a.createElement("option",null," --- "),_.map(function(e){return c.a.createElement("option",{key:e.id,value:e.id,selected:String(e.id)===s},e.name)}))),c.a.createElement(x.d,{className:"col"},c.a.createElement(z.a,{addonType:"prepend"},"Result"),c.a.createElement(x.c,{name:"rid",type:"select",onChange:b},c.a.createElement("option",null," --- "),_.map(function(e){return c.a.createElement("option",{key:e.id,value:e.id,selected:String(e.id)===u},e.name)}))))},W=a(89),J=a.n(W),$=function(e){return e.filter(function(e){return J.a.isWeekDay(e)}).map(function(e){return e.format("YYYY-MM-DD")})},F=function(e){var t=e.item,a=e.biz_days,n=t.format("YYYY-MM-DD");return c.a.createElement("div",{className:"form-check form-check-inline"},c.a.createElement(x.c,{disabled:J.a.isWeekendDay(t),id:n,value:n,type:"checkbox",defaultChecked:_.a.includes(a,n),className:"form-check-input"}),c.a.createElement(x.f,{className:"form-check-label",for:n},n))},q=function(){var e=Object(r.useContext)(I),t=e.state,a=t.mid,n=t.milestones,s=t.biz_days,u=e.setBizDays,l=function(e,t){return t.find(function(t){return String(t.id)===e})}(a,n);if(l){var o=function(e){var t=b()(e.estimated_start),a=b()(e.estimated_finish).diff(t,"days");return _.a.times(a).map(function(e){return t.clone().add(e,"days")})}(l);return(0===s.length||b()(l.estimated_start).diff(b()(_.a.first(s)))>0||b()(l.estimated_finish).diff(b()(_.a.last(s)))<0)&&u($(o)),c.a.createElement(c.a.Fragment,null,o.map(function(e){return c.a.createElement(F,{key:e.toString(),item:e,biz_days:s})}))}return c.a.createElement("h1",null,"loading...")},G=function(){var e=Object(r.useContext)(I),t=e.state,a=e.setUrl,n=Object(r.useState)(""),s=Object(l.a)(n,2),u=s[0],o=s[1],i=Object(r.useCallback)(function(e){o(e.target.value)},[o]),m=Object(r.useCallback)(function(e){u&&a(u),e.preventDefault()},[u,a]);return c.a.createElement(x.b,{onSubmit:m},c.a.createElement(x.d,null,c.a.createElement(x.e,{addonType:"prepend"},"URL"),c.a.createElement(x.c,{defaultValue:t.url,onChange:i,placeholder:"http://hostname:port"}),c.a.createElement(x.e,{addonType:"append"},c.a.createElement(x.a,null,"Set"))),c.a.createElement("div",{className:"row"},c.a.createElement(V,null),c.a.createElement(K,null)),c.a.createElement(Z,null),c.a.createElement(q,null))},H=function(e,t){return e&&e.attributes_values&&Number(e.attributes_values[t])||0},Q=function(e,t,a,n){return _.a.chain(function(e){return _.a.groupBy(e,"assigned_to")}(e)).mapValues(function(e){return e.map(function(e){return t.get(e)}).reduce(function(e,t){return{e:e.e+H(t,Number(a)),r:e.r+H(t,Number(n))}},{e:0,r:0})}).value()},X=function(e,t){return e.find(function(e){return e.id===t})},ee=function(){var e=Object(r.useContext)(I).state,t=e.url,a=e.pid,n=e.tasks,s=e.custom_value_map,u=e.custom_attrs,o=e.custom_eid,i=e.custom_rid,m=Object(r.useState)([]),d=Object(l.a)(m,2),f=d[0],p=d[1];Object(r.useEffect)(function(){t&&a&&Object(N.a)(Y.a.mark(function e(){var n,r;return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a.get("".concat(v(t),"/projects/").concat(a));case 2:n=e.sent,r=n.data.members,p(r);case 5:case"end":return e.stop()}},e,this)}))()},[t,a,p]);var E=Q(n,s,o,i),S=X(u,Number(o)),b=X(u,Number(i));return S&&b?c.a.createElement(x.g,null,c.a.createElement("thead",null,c.a.createElement("tr",null,c.a.createElement("th",null,"Name"),c.a.createElement("th",null,S.name),c.a.createElement("th",null,b.name))),c.a.createElement("tbody",null,f.map(function(e){return c.a.createElement("tr",null,c.a.createElement("td",null,e.username),c.a.createElement("td",null,_.a.get(E,"".concat(e.id,".e"))),c.a.createElement("td",null,_.a.get(E,"".concat(e.id,".r"))))}))):null},te=function(){return c.a.createElement("div",{className:"container"},c.a.createElement(U,null,c.a.createElement(G,null),c.a.createElement(ee,null),c.a.createElement(A,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(c.a.createElement(te,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[138,2,1]]]);
//# sourceMappingURL=main.09ed9557.chunk.js.map